System`Cell[System`BoxData[System`RowBox[System`List["PRedefinePublicFunction", "[", "\[IndentingNewLine]", System`RowBox[System`List[System`RowBox[System`List["InfiniTAMVoxelBlocksGridDataFromRules", "[", System`RowBox[System`List["rules", ":", System`RowBox[System`List["{", System`RowBox[System`List[System`RowBox[System`List["(", System`RowBox[System`List[System`RowBox[System`List["_Integer", "~", "Table", "~", "3"]], "\[Rule]", System`RowBox[System`List["{", System`RowBox[System`List["_", ",", "_", ",", System`RowBox[System`List["{", System`RowBox[System`List["_", ",", "_", ",", "_"]], "}"]], ",", "_"]], "}"]]]], ")"]], ".."]], "}"]]]], "]"]], "\[IndentingNewLine]", ",", "\"undo InfiniTAMVoxelBlocksGridDataAsRules. Note that blocks cannot be exactly recovered if the dataset is sparse.\nFor sparse datasets, the first block is less than or equal to the lower coordinate bounds, subject to being aligned on the grid.\n\nMissing data is filled with InfiniTAMMissingVoxelData[]\"", ",", "\[IndentingNewLine]", System`RowBox[System`List[System`RowBox[System`List["{", System`RowBox[System`List["rulesAssoc", "=", System`RowBox[System`List["Association", "@", "rules"]]]], "}"]], "~", "With", "~", System`RowBox[System`List["(*", System`RowBox[System`List["cannot", " ", "iterate", " ", "this", " ", "as", " ", "well", " ", System`RowBox[System`List["(", "bugfix", ")"]]]], "*)"]], "\[IndentingNewLine]", System`RowBox[System`List["With", "[", "\[IndentingNewLine]", System`RowBox[System`List[System`RowBox[System`List["{", System`RowBox[System`List["coordinateBounds", "=", System`RowBox[System`List[System`RowBox[System`List[System`RowBox[System`List["{", System`RowBox[System`List[System`RowBox[System`List["#1", "~", "Floor", "~", System`RowBox[System`List["InfiniTAMSdfBlockSize", "[", "]"]]]], ",", "#2"]], "}"]], "&"]], "@@@", System`RowBox[System`List["CoordinateBounds", "@", System`RowBox[System`List["Keys", "@", "rules"]]]]]]]], System`RowBox[System`List["(*", System`RowBox[System`List["align", " ", "lower", " ", "coordinates"]], "*)"]], "}"]], ",", "\[IndentingNewLine]", System`RowBox[System`List["{", System`RowBox[System`List["extendedCoordinateBounds", "=", System`RowBox[System`List["coordinateBounds", "~", "CoordinateBoundsAddAll", "~", System`RowBox[System`List["{", System`RowBox[System`List["0", ",", System`RowBox[System`List[System`RowBox[System`List["InfiniTAMSdfBlockSize", "[", "]"]], "-", "1"]]]], "}"]]]]]], System`RowBox[System`List["(*", System`RowBox[System`List["extend", " ", "max", " ", "to", " ", "fit", " ", "enough", " ", "blocks", " ", "in", " ", "worst", " ", "case"]], "*)"]], "}"]], ",", "\[IndentingNewLine]", System`RowBox[System`List["{", System`RowBox[System`List["blocksCoordinates", "=", System`RowBox[System`List["PartitionRangeApproximately3DByLengthFlat", "[", System`RowBox[System`List["extendedCoordinateBounds", ",", System`RowBox[System`List[System`RowBox[System`List["InfiniTAMSdfBlockSize", "[", "]"]], "~", "Table", "~", "3"]]]], "]"]]]], "}"]], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", System`RowBox[System`List[System`RowBox[System`List["Assert", "[", System`RowBox[System`List[System`RowBox[System`List["Length", "[", System`RowBox[System`List["blocksCoordinates", "[", System`RowBox[System`List["[", System`RowBox[System`List["1", ",", "1"]], "]"]], "]"]], "]"]], "\[Equal]", "3"]], "]"]], ";", "\[IndentingNewLine]", System`RowBox[System`List["Assert", "[", System`RowBox[System`List["And", "@@", System`RowBox[System`List["(", System`RowBox[System`List[System`RowBox[System`List["blocksCoordinates", "[", System`RowBox[System`List["[", System`RowBox[System`List["1", ",", "1"]], "]"]], "]"]], "~", "Divisible", "~", System`RowBox[System`List["InfiniTAMSdfBlockSize", "[", "]"]]]], ")"]]]], "]"]], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", System`RowBox[System`List["Block", "[", System`RowBox[System`List[System`RowBox[System`List["{", System`RowBox[System`List["processBlockCoordinates", ",", "definedCoordinateQ", ",", "coordinateToDataRule", ",", "makePosGridDataRuleForCoordinates"]], "}"]], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", System`RowBox[System`List[System`RowBox[System`List[System`RowBox[System`List["definedCoordinateQ", "[", System`RowBox[System`List["c", ":", System`RowBox[System`List["_Integer", "~", "Table", "~", "3"]]]], "]"]], ":=", System`RowBox[System`List["Not", "@", System`RowBox[System`List["MissingQ", "@", System`RowBox[System`List["Lookup", "[", System`RowBox[System`List["rulesAssoc", ",", System`RowBox[System`List["Key", "@", "c"]]]], System`RowBox[System`List["(*", System`RowBox[System`List[System`RowBox[System`List["must", " ", "use", " ", "Key"]], ",", " ", System`RowBox[System`List[System`RowBox[System`List["List", " ", "is", " ", "understood", " ", "as", " ", "multi"]], "-", "lookup"]]]], "*)"]], "]"]]]]]]]], ";", "\[IndentingNewLine]", System`RowBox[System`List[System`RowBox[System`List["coordinateToDataRule", "[", System`RowBox[System`List[System`RowBox[System`List["c", ":", System`RowBox[System`List["_Integer", "~", "Table", "~", "3"]]]], ",", System`RowBox[System`List["base", ":", System`RowBox[System`List["_Integer", "~", "Table", "~", "3"]]]]]], "]"]], ":=", System`RowBox[System`List[System`RowBox[System`List["(", System`RowBox[System`List["c", "-", "base", "+", "1"]], ")"]], "->", System`RowBox[System`List["If", "[", System`RowBox[System`List[System`RowBox[System`List["!", System`RowBox[System`List["definedCoordinateQ", "[", "c", "]"]]]], ",", System`RowBox[System`List["InfiniTAMMissingVoxelData", "[", "]"]], ",", System`RowBox[System`List["Lookup", "[", System`RowBox[System`List["rulesAssoc", ",", System`RowBox[System`List["Key", "@", "c"]]]], "]"]]]], "]"]]]]]], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", System`RowBox[System`List[System`RowBox[System`List["processBlockCoordinates", "[", System`RowBox[System`List[System`RowBox[System`List["coordinates", ":", System`RowBox[System`List["{", System`RowBox[System`List[System`RowBox[System`List["_Integer", "~", "Table", "~", "3"]], ".."]], "}"]]]], ",", System`RowBox[System`List["base", ":", System`RowBox[System`List["_Integer", "~", "Table", "~", "3"]]]]]], "]"]], ":=", System`RowBox[System`List["If", "[", "\[IndentingNewLine]", System`RowBox[System`List[System`RowBox[System`List["NoneTrue", "[", System`RowBox[System`List["coordinates", ",", "definedCoordinateQ"]], "]"]], ",", System`RowBox[System`List["Missing", "[", "base", "]"]], ",", System`RowBox[System`List["(*", System`RowBox[System`List["keep", " ", "only", " ", "blocks", " ", "which", " ", "contain", " ", "at", " ", "least", " ", "one", " ", "coordinate", " ", "in", " ", "rules"]], "*)"]], "\[IndentingNewLine]", System`RowBox[System`List[System`RowBox[System`List[System`RowBox[System`List["coordinateToDataRule", "[", System`RowBox[System`List["#", ",", "base"]], "]"]], "&"]], "/@", "coordinates"]]]], "\[IndentingNewLine]", "]"]]]], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", System`RowBox[System`List[System`RowBox[System`List["makePosGridDataRuleForCoordinates", "[", System`RowBox[System`List["coordinates", ":", System`RowBox[System`List["{", System`RowBox[System`List[System`RowBox[System`List["_Integer", "~", "Table", "~", "3"]], ".."]], "}"]]]], "]"]], ":=", System`RowBox[System`List["(", "\[IndentingNewLine]", System`RowBox[System`List[System`RowBox[System`List["Assert", "[", System`RowBox[System`List["And", "@@", System`RowBox[System`List["(", System`RowBox[System`List[System`RowBox[System`List["First", "@", "coordinates"]], "~", "Divisible", "~", System`RowBox[System`List["InfiniTAMSdfBlockSize", "[", "]"]]]], ")"]]]], "]"]], ";", "\[IndentingNewLine]", System`RowBox[System`List["With", "[", System`RowBox[System`List[System`RowBox[System`List["{", System`RowBox[System`List["base", "=", System`RowBox[System`List["First", "@", "coordinates"]]]], "}"]], ",", System`RowBox[System`List["With", "[", System`RowBox[System`List[System`RowBox[System`List["{", System`RowBox[System`List["gridDataRules", "=", System`RowBox[System`List["processBlockCoordinates", "[", System`RowBox[System`List["coordinates", ",", "base"]], "]"]]]], "}"]], ",", "\[IndentingNewLine]", System`RowBox[System`List["If", "[", System`RowBox[System`List[System`RowBox[System`List["MissingQ", "@", "gridDataRules"]], ",", "Nothing", ",", "\[IndentingNewLine]", System`RowBox[System`List[System`RowBox[System`List["base", "/", System`RowBox[System`List["InfiniTAMSdfBlockSize", "[", "]"]]]], System`RowBox[System`List["(*", "voxelBlockPos", "*)"]], "\[Rule]", System`RowBox[System`List["List", "@", System`RowBox[System`List["GridDataMakeFromRules", "[", System`RowBox[System`List[System`RowBox[System`List["InfiniTAMVoxelAttributes", "[", "]"]], ",", "gridDataRules"]], "]"]]]]]]]], "\[IndentingNewLine]", "]"]]]], "\[IndentingNewLine]", "]"]]]], "]"]]]], "\[IndentingNewLine]", ")"]]]], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", System`RowBox[System`List["GridDataMakeFromRules", "[", System`RowBox[System`List[System`RowBox[System`List["{", "\"voxelBlock\"", "}"]], ",", System`RowBox[System`List["makePosGridDataRuleForCoordinates", "/@", "blocksCoordinates"]]]], "]"]]]]]], "\[IndentingNewLine]", "\[IndentingNewLine]", "]"]]]]]], "\[IndentingNewLine]", "]"]]]], "\[IndentingNewLine]", ",", "_GridData"]], "\[IndentingNewLine]", "]"]]], "Input", System`Rule[System`CellChangeTimes, System`List[System`List[3.68294411951639`*^9, 3.68294426685433`*^9], System`List[3.682944376514226`*^9, 3.6829444594467573`*^9], System`List[3.682944682391082`*^9, 3.6829447863448544`*^9], System`List[3.682945620112708`*^9, 3.6829456470633698`*^9], System`List[3.68294573101718`*^9, 3.6829457554897118`*^9], System`List[3.6829473052063804`*^9, 3.682947460410137`*^9], System`List[3.682947496636361`*^9, 3.682947499093428`*^9], System`List[3.6829475336956244`*^9, 3.6829477081824536`*^9], System`List[3.682947741856475`*^9, 3.682947938530016`*^9], System`List[3.682947981928195`*^9, 3.682947982660107`*^9], System`List[3.6829480135827117`*^9, 3.6829480750724745`*^9], System`List[3.682950380246081`*^9, 3.6829504832587156`*^9], System`List[3.682950559923147`*^9, 3.6829505636077766`*^9], System`List[3.682950673287633`*^9, 3.68295075662385`*^9], System`List[3.682950902856902`*^9, 3.6829510103659563`*^9], System`List[3.682951083425264`*^9, 3.6829512160761366`*^9], System`List[3.6829512563799477`*^9, 3.6829513284861927`*^9], System`List[3.682951388444297`*^9, 3.6829514964410763`*^9]]]]