System`Cell[System`BoxData[System`RowBox[System`List[System`RowBox[System`List["PRedefinePublicFunction", "[", "\n", System`RowBox[System`List[System`RowBox[System`List["Vsfs2dCreateExampleScene1", "[", "\n", "  ", System`RowBox[System`List[System`RowBox[System`List["Optional", "[", System`RowBox[System`List[System`RowBox[System`List["blur_", "?", "NumericQ"]], ",", " ", "3"]], "]"]], ",", "\n", "  ", System`RowBox[System`List["Optional", "[", System`RowBox[System`List[System`RowBox[System`List["lightDirection", ":", System`RowBox[System`List[System`RowBox[System`List["{", System`RowBox[System`List["_", ",", "_"]], "}"]], "?", "NumericVectorQ"]]]], ",", " ", System`RowBox[System`List["Normalize", "[", System`RowBox[System`List["{", System`RowBox[System`List["2.", ",", " ", "1."]], "}"]], "]"]]]], "]"]]]], "\n", "  ", "]"]], " ", "\n", "  ", ",", "\"from vsfs2d`\"", ",", "\n", "  ", "\n", "    ", System`RowBox[System`List["Module", "[", System`RowBox[System`List[System`RowBox[System`List["{", System`RowBox[System`List["block", ",", " ", "extra", ",", " ", "matrixToFunction", ",", "\n", "      ", "functionToMatrix", ",", " ", "derivativeToNormal", ",", " ", "x0", ",", " ", "y0", ",", " ", "w", ",", " ", "h", ",", " ", "dsharp", ",", "\n", "      ", "doriginal", ",", " ", "shapeImage", ",", " ", "normalField", ",", " ", "dt", ",", " ", "c", ",", " ", "lightIntensity", ",", "\n", "      ", "normalize", ",", " ", "norm", ",", " ", "norm2", ",", " ", "img", ",", " ", "demo", ",", " ", "g", ",", " ", "l", ",", " ", "m", ",", " ", "line", ",", " ", "normals", ",", " ", "derivatives", ",", " ", "d"]], "}"]], ",", "\n", "      ", "\n", "    ", System`RowBox[System`List[System`RowBox[System`List["block", " ", "=", " ", "4"]], ";", "\n", "    ", System`RowBox[System`List["extra", " ", "=", " ", "2"]], ";", "\n", "    ", System`RowBox[System`List[System`RowBox[System`List["matrixToFunction", "[", System`RowBox[System`List["matrix_", ",", " ", System`RowBox[System`List["{", System`RowBox[System`List["x0_", ",", " ", "y0_"]], "}"]]]], "]"]], " ", ":=", "\n", "        ", System`RowBox[System`List[System`RowBox[System`List["With", "[", System`RowBox[System`List[System`RowBox[System`List["{", System`RowBox[System`List[System`RowBox[System`List["x", " ", "=", " ", System`RowBox[System`List["#", "[", System`RowBox[System`List["[", "1", "]"]], "]"]]]], ",", " ", System`RowBox[System`List["y", " ", "=", " ", System`RowBox[System`List["#", "[", System`RowBox[System`List["[", "2", "]"]], "]"]]]]]], "}"]], ",", " ", System`RowBox[System`List["matrix", "[", System`RowBox[System`List["[", System`RowBox[System`List[System`RowBox[System`List["y", " ", "-", " ", "y0", " ", "+", " ", "1"]], ",", " ", System`RowBox[System`List["x", " ", "-", " ", "x0", " ", "+", " ", "1"]]]], "]"]], "]"]]]], "]"]], " ", "&"]]]], ";", "\n", "    ", System`RowBox[System`List[System`RowBox[System`List["functionToMatrix", "[", System`RowBox[System`List["f_", ",", " ", System`RowBox[System`List["{", System`RowBox[System`List["x0_", ",", " ", "y0_"]], "}"]], ",", " ", System`RowBox[System`List["{", System`RowBox[System`List["w_", ",", " ", "h_"]], "}"]]]], "]"]], " ", ":=", "\n", "        ", System`RowBox[System`List["Table", "[", System`RowBox[System`List[System`RowBox[System`List["f", "[", System`RowBox[System`List["{", System`RowBox[System`List["x", ",", " ", "y"]], "}"]], "]"]], ",", " ", System`RowBox[System`List["{", System`RowBox[System`List["y", ",", " ", "y0", ",", " ", System`RowBox[System`List["y0", " ", "+", " ", "h", " ", "-", " ", "1"]]]], "}"]], ",", " ", System`RowBox[System`List["{", System`RowBox[System`List["x", ",", " ", "x0", ",", " ", System`RowBox[System`List["x0", " ", "+", " ", "w", " ", "-", " ", "1"]]]], "}"]]]], "]"]]]], ";", "\n", "    ", System`RowBox[System`List["derivativeToNormal", " ", "=", " ", System`RowBox[System`List[System`RowBox[System`List["(", System`RowBox[System`List["1.", " ", System`RowBox[System`List["Normalize", "[", System`RowBox[System`List["Cross", "@", System`RowBox[System`List["{", System`RowBox[System`List["1", ",", " ", "#"]], "}"]]]], "]"]]]], ")"]], " ", "&"]]]], ";", "\n", "    ", System`RowBox[System`List["(*", System`RowBox[System`List["full", " ", "example", " ", System`RowBox[System`List["(", System`RowBox[System`List["quite", " ", "large"]], ")"]]]], "*)"]], "\n", "    ", System`RowBox[System`List[System`RowBox[System`List["{", System`RowBox[System`List["x0", ",", " ", "y0"]], "}"]], " ", "=", " ", System`RowBox[System`List["{", System`RowBox[System`List["1", ",", " ", "1"]], "}"]]]], ";", "\n", "    ", System`RowBox[System`List[System`RowBox[System`List["{", System`RowBox[System`List["w", ",", " ", "h"]], "}"]], " ", "=", " ", System`RowBox[System`List["{", System`RowBox[System`List[System`RowBox[System`List["8", "*", "block"]], ",", " ", System`RowBox[System`List["8", "*", "block"]]]], "}"]]]], ";", "\n", "    ", System`RowBox[System`List["(*", System`RowBox[System`List[System`RowBox[System`List[System`RowBox[System`List["tiny", " ", "example", System`RowBox[System`List["{", System`RowBox[System`List["x0", ",", "y0"]], "}"]]]], "=", System`RowBox[System`List["{", System`RowBox[System`List["5", ",", "5"]], "}"]]]], ";", "\n", "   ", System`RowBox[System`List[System`RowBox[System`List["{", System`RowBox[System`List["w", ",", "h"]], "}"]], "=", System`RowBox[System`List["{", System`RowBox[System`List["block", ",", "block"]], "}"]]]], ";", "\n", "   ", System`RowBox[System`List["(*", System`RowBox[System`List["minimal", " ", "example"]], "*)"]], System`RowBox[System`List[System`RowBox[System`List["{", System`RowBox[System`List["x0", ",", "y0"]], "}"]], "=", System`RowBox[System`List["{", System`RowBox[System`List["1", ",", "5"]], "}"]]]], ";", "\n", "   ", System`RowBox[System`List[System`RowBox[System`List["{", System`RowBox[System`List["w", ",", "h"]], "}"]], "=", System`RowBox[System`List["{", System`RowBox[System`List[System`RowBox[System`List["4", "*", "block"]], ",", System`RowBox[System`List["2", "*", "block"]]]], "}"]]]], ";"]], "*)"]], "\n", "\n", "    ", System`RowBox[System`List[System`RowBox[System`List["line", "[", System`RowBox[System`List[System`RowBox[System`List["{", System`RowBox[System`List["x0_", ",", " ", "y0_"]], "}"]], ",", " ", System`RowBox[System`List["{", System`RowBox[System`List["x1_", ",", " ", "y1_"]], "}"]], ",", " ", "x_"]], "]"]], " ", ":=", "\n", "        ", System`RowBox[System`List["If", "[", System`RowBox[System`List[System`RowBox[System`List["x0", " ", "<=", " ", "x", " ", "<=", " ", "x1"]], ",", " ", System`RowBox[System`List[System`RowBox[System`List[System`RowBox[System`List["(", System`RowBox[System`List["x", " ", "-", " ", "x0"]], ")"]], "*", System`RowBox[System`List[System`RowBox[System`List["(", System`RowBox[System`List["y1", " ", "-", " ", "y0"]], ")"]], "/", System`RowBox[System`List["(", System`RowBox[System`List["x1", " ", "-", " ", "x0"]], ")"]]]]]], " ", "+", " ", "y0"]], ",", " ", "0."]], "]"]]]], ";", "\n", "    ", System`RowBox[System`List[System`RowBox[System`List["demo", "[", "x_", "]"]], " ", ":=", "\n", "        ", System`RowBox[System`List[System`RowBox[System`List["line", "[", System`RowBox[System`List[System`RowBox[System`List["{", System`RowBox[System`List[".2", ",", " ", "0."]], "}"]], ",", " ", System`RowBox[System`List["{", System`RowBox[System`List[".4", ",", " ", "1."]], "}"]], ",", " ", "x"]], "]"]], " ", "+", " ", System`RowBox[System`List["line", "[", System`RowBox[System`List[System`RowBox[System`List["{", System`RowBox[System`List[".4", ",", " ", "1."]], "}"]], ",", " ", System`RowBox[System`List["{", System`RowBox[System`List[".6", ",", " ", "1."]], "}"]], ",", " ", "x"]], "]"]], " ", "+", "\n", "            ", System`RowBox[System`List["line", "[", System`RowBox[System`List[System`RowBox[System`List["{", System`RowBox[System`List[".6", ",", " ", "1."]], "}"]], ",", " ", System`RowBox[System`List["{", System`RowBox[System`List[".8", ",", " ", "0."]], "}"]], ",", " ", "x"]], "]"]]]]]], ";", "\n", "    ", System`RowBox[System`List["d", " ", "=", " ", "9."]], ";", "\n", "    ", System`RowBox[System`List[System`RowBox[System`List["g", "[", "x_", "]"]], " ", ":=", " ", System`RowBox[System`List["\[Piecewise]", System`RowBox[System`List["{", System`RowBox[System`List[System`RowBox[System`List["{", System`RowBox[System`List[System`RowBox[System`List["16.", " ", "-", " ", "d", " ", "+", " ", System`RowBox[System`List["(", System`RowBox[System`List["x", " ", "-", " ", "16.", " ", "+", " ", "d"]], ")"]]]], ",", "\n", "      ", System`RowBox[System`List["16.", " ", ">", " ", "x", " ", ">=", " ", System`RowBox[System`List["16.", " ", "-", " ", "d"]]]]]], "}"]], ",", " ", System`RowBox[System`List["{", System`RowBox[System`List[System`RowBox[System`List["16.", " ", "-", " ", System`RowBox[System`List["(", System`RowBox[System`List["x", " ", "-", " ", "16."]], ")"]]]], ",", " ", System`RowBox[System`List[System`RowBox[System`List["16.", " ", "+", " ", "d"]], " ", ">", " ", "x", " ", ">=", " ", "16."]]]], "}"]], ",", " ", System`RowBox[System`List["{", System`RowBox[System`List[System`RowBox[System`List["16.", " ", "-", " ", "d"]], ",", "\n", "      ", "True"]], "}"]]]], "}"]]]]]], ";", "\n", "    ", System`RowBox[System`List[System`RowBox[System`List["shapeImage", "[", System`RowBox[System`List["{", System`RowBox[System`List["x_", ",", " ", "y_"]], "}"]], "]"]], " ", ":=", " ", System`RowBox[System`List["If", "[", System`RowBox[System`List[System`RowBox[System`List[System`RowBox[System`List["g", "[", "x", "]"]], " ", "<=", " ", "y"]], ",", " ", "1.", ",", " ", "0."]], "]"]]]], ";", "\n", "    ", System`RowBox[System`List[System`RowBox[System`List["normalField", "[", System`RowBox[System`List["{", System`RowBox[System`List["x_", ",", " ", "y_"]], "}"]], "]"]], " ", ":=", " ", System`RowBox[System`List["derivativeToNormal", "@", System`RowBox[System`List["(", System`RowBox[System`List[System`RowBox[System`List["g", "[", System`RowBox[System`List["x", " ", "+", " ", "1"]], "]"]], " ", "-", " ", System`RowBox[System`List["g", "[", "x", "]"]]]], ")"]]]]]], ";", "\n", "\n", "    ", System`RowBox[System`List["img", " ", "=", " ", System`RowBox[System`List["Image", "@", "\n", "        ", System`RowBox[System`List["functionToMatrix", "[", System`RowBox[System`List["shapeImage", ",", " ", System`RowBox[System`List["{", System`RowBox[System`List[System`RowBox[System`List["x0", " ", "-", " ", "2"]], ",", " ", System`RowBox[System`List["y0", " ", "-", " ", "2"]]]], "}"]], ",", " ", System`RowBox[System`List["{", System`RowBox[System`List[System`RowBox[System`List["w", " ", "+", " ", "4"]], ",", " ", System`RowBox[System`List["h", " ", "+", " ", "4"]]]], "}"]]]], "]"]]]]]], ";", "\n", "    ", System`RowBox[System`List["dt", " ", "=", " ", System`RowBox[System`List[System`RowBox[System`List["ImageData", "@", System`RowBox[System`List["DistanceTransform", "[", System`RowBox[System`List["#", ",", " ", System`RowBox[System`List["Padding", " ", "->", " ", "\"Fixed\""]]]], "]"]]]], " ", "&"]]]], ";", "\n", "    ", System`RowBox[System`List["dsharp", " ", "=", " ", System`RowBox[System`List[System`RowBox[System`List["dt", "@", "img"]], " ", "-", " ", System`RowBox[System`List["dt", "@", System`RowBox[System`List["ColorNegate", "@", "img"]]]]]]]], ";", "\n", "    ", System`RowBox[System`List["dsharp", " ", "/=", " ", "30."]], ";", "\n", "    ", System`RowBox[System`List["doriginal", " ", "=", " ", System`RowBox[System`List["ImageData", "@", System`RowBox[System`List["Blur", "[", System`RowBox[System`List[System`RowBox[System`List["Image", "@", "dsharp"]], ",", " ", "blur"]], "]"]]]]]], ";", "\n", "    ", System`RowBox[System`List[System`RowBox[System`List["norm2", "@", "v_"]], " ", ":=", " ", System`RowBox[System`List["v", ".", "v"]]]], ";", " ", System`RowBox[System`List[System`RowBox[System`List["norm", "@", "v_"]], " ", ":=", " ", System`RowBox[System`List["Sqrt", "@", System`RowBox[System`List["norm2", "@", "v"]]]]]], ";", " ", System`RowBox[System`List[System`RowBox[System`List["normalize", "@", "v_"]], " ", ":=", " ", System`RowBox[System`List["v", "/", System`RowBox[System`List["norm", "@", "v"]]]]]], ";", "\n", "    ", System`RowBox[System`List[System`RowBox[System`List["lightIntensity", "@", "n_"]], " ", ":=", " ", System`RowBox[System`List["Max", "[", System`RowBox[System`List[System`RowBox[System`List["n", ".", System`RowBox[System`List["normalize", "@", "lightDirection"]]]], ",", " ", "0."]], "]"]]]], ";", "\n", "    ", System`RowBox[System`List["c", " ", "=", " ", System`RowBox[System`List["Table", "[", System`RowBox[System`List[System`RowBox[System`List["{", System`RowBox[System`List["lightIntensity", "@", System`RowBox[System`List["normalField", "[", System`RowBox[System`List["{", System`RowBox[System`List["x", ",", " ", "y"]], "}"]], "]"]]]], "}"]], ",", " ", System`RowBox[System`List["{", System`RowBox[System`List["y", ",", " ", System`RowBox[System`List["y0", " ", "-", " ", "2"]], ",", "\n", "      ", System`RowBox[System`List["y0", " ", "+", " ", "h", " ", "+", " ", "1"]]]], "}"]], ",", " ", System`RowBox[System`List["{", System`RowBox[System`List["x", ",", " ", System`RowBox[System`List["x0", " ", "-", " ", "2"]], ",", " ", System`RowBox[System`List["x0", " ", "+", " ", "w", " ", "+", " ", "1"]]]], "}"]]]], "]"]]]], "\n", "\n", "    ", ";", System`RowBox[System`List[System`RowBox[System`List["{", System`RowBox[System`List["a", "=", System`RowBox[System`List["<|", System`RowBox[System`List[System`RowBox[System`List["\"c\"", " ", "->", " ", "c"]], ",", " ", System`RowBox[System`List["\"doriginal\"", " ", "->", " ", "doriginal"]], ",", " ", System`RowBox[System`List["\"dsharp\"", " ", "->", " ", "dsharp"]], ",", "\n", "      ", System`RowBox[System`List["\"lightDirection\"", " ", "->", " ", "lightDirection"]]]], "|>"]]]], "}"]], "~", "With", "~", System`RowBox[System`List["Vsfs2dInitialize", "@", System`RowBox[System`List["Scene", "@", "a"]]]]]]]]]], "\n", "\n", "    ", "]"]]]], "\n", "    ", "]"]], ";"]]], "Code", System`Rule[System`CellChangeTimes, System`List[System`List[3.681730561430951`*^9, 3.681730561430951`*^9], 3.681730634553775`*^9, 3.6817307355221767`*^9, System`List[3.6817307725404778`*^9, 3.681730792024911`*^9], System`List[3.681730846606368`*^9, 3.6817308524370327`*^9], System`List[3.6817308935779247`*^9, 3.681730905346652`*^9]]], System`Rule[System`CellTags, "depersistedCell4b37c5d4-7d71-4113-865c-d53e74810f68"]]